<!DOCTYPE html>
<html lang="en">
  <head>
  
    <title>Sosiaalisen Median Tekniikat</title>


    <link rel="stylesheet" href="stylesheets/lattex.css">    
    <script src="javascripts/lattex.js"></script>

    <script src="hyphenator/Hyphenator.js" type="text/javascript"></script>
    <script type="text/javascript">
    	Hyphenator.config({
    		displaytogglebox : false,
    		minwordlength : 4
    	});

		Hyphenator.run();

    </script>




  </head>
  
    
  <body>

    <header>
      <h1 data-lattex="title"></h1>

      <address>
        Matti Paksula
      </address>
      
    </header>

	<article>
		<h1>Tiivistelmä</h1>
		
		<pre>
			TODO
		</pre>
	</article>
	
	    
  
	<nav></nav>


	
    <article>
		<h1 data-lattex="title"></h1>


		
		<section>
        	<h1>Johdanto</h1>
        
        	<pre>Sosiaalinen media tarkoittaa web-palveluita, joiden avulla käyttäjä voi luoda ja jakaa omaa sisältöään sosiaaliselle verkostolleen. Esimerkkejä tälläisistä palveluista ovat omien kuvien tai videoiden jakaminen, paikkatiedon jakaminen ja tuotteiden tai palveluiden suosittelu.  Palveluita on kehitetty myös erityisesti työmaailmaan sopiviksi tehostamaan mm. ryhmätyöskentelyä ja tiedonvälitystä <cite>GJW07</cite>.
	
				Databases and Web 2.0 panel: web 2.0 määritelmä
	
				
				Palveluissa käyttäjien jakama (tai tuottama) sisältö tunnetaan nimellä <em>User-generated content</em> (UGC).  Sisältö muodostuu erilaisista web-objekteista (kuvista, kommenteista, ym.), jotka toimivat palveluiden varsinaisena sisältönä <cite>YLM09</cite>.  Esimerkiksi Facebookkiin talletetaan yli 30 miljardia objektia kuukaudessa <cite>Fac10</cite>.
				
				Vaikka saman sektorin palveluita on useita, on palveluiden tuottaminen yleensä keskittynyt muutamalle yritykselle.  Koska palveluiden idea perustuu sosiaalisiin verkostoihin, on kilpailijoiden vaikeaa saada tarpeeksi käyttäjiä omaan palveluunsa, jotta se voisi olla kannattava.  Suosituimpien web-palveluiden käyttäjämäärät kasvavatkin yleensä varsin nopeasti, sillä palveluita käytetään maailmanlaajuisesti.  Käyttäjät käyttävät palveluita myös hyvin aktiivisesti, yleensä jopa päivittäin <cite>Gol07</cite>.
				
				Tässä artikkelissa tarkistellaan suurten käyttäjämäärien ja objektien tuomia ongelmia arkkitehtuurisella toteutustasolla.  Kappaleessa TODO esitellään muutama suuren kokoluokan arkkitehtuuri, sitten tarkastellaan laajemmin toteutusongelmia ja lopuksi luodaan katsaus yleisesti kätettyihin tekniikkoihin ja arkkitehtuurimalleihin.
			</pre>
		</section>
		
		<section>
			<h1>Backgroundz</h1>
			
			<pre>
				Käyttäjämäärät

				Scaling little engines that cloud
				<cite>PES10</cite>

				OSNs online social networks

				horisontaalinen ja vertikaalinen skaalaaminen

				osnissä highly personal content
				 - vertikaalinen skaalaaminen mahdotonta: datamäärä

				OSN defacto partitoning is distrubuted
				
			    ---------
			
			
				Skaalautuminen
			</pre>
			
			
			<section>
				<h1>CAP</h1>
				
				<pre>Eric Brewer on esittänyt vuonna 2000 CAP-konjektuurin <cite>Bre02</cite> hajautettujen web-palveluiden kolmesta halutusta ominaisuudesta ja niiden saavutettavuuksista.  Kolme haluttua ominaisuutta ovat tiedon konsistenssi, saavutettavuus ja jakaminen (<strong>C</strong>onsistency, <strong>A</strong>vailability, <strong>P</strong>artitioning). 
					
					Hajautetun web-palvelun tietosisältöön kohdistuvat muokkaukset halutaan yleisesti pitää vahvasti konsistentteina. <!-- TODO: mikä on konsistentti-->Tämä tarkoittaa ACID-ominaisuudet tyydyttävää tietokantamaista toimintaa, eli esimerkiksi muokkausoperaatioiden suorittaminen siten, ettei muokkauksen kohteena oleva tietosisältö minään hetkenä koostu vanhasta ja uudesta tiedosta.  Tämä tiedon atomisuus vaatii esimerkiksi lukitusta, joka on haastavaa toteuttaa hajautetussa ympäristössä <cite>GiL02</cite>.
										
					Tiedon saatavuus halutaan myös pitää korkeana.  Web-palvelua ei käytännössä ole olemassa jos sitä ei voida saavuttaa.  Jotta palvelu seliväisi verkkokatkoksista esimerkiksi eri mantereiden välillä, on palvelu ylläpidettävä hajautetusti.  Tämä hajautus taas vaikeuttaa tiedon pitämistä konsistenttina <cite>GiL02</cite>.
					
					Hetkellisen verkkokatkoksen aikana tehdyt päivitykset kahteen palvelinkeskukseen aiheuttavat tiedon synkronointiongelman, kun yhteys jälleen palautuu<cite>GiL02</cite>.  Saman tietosisällön hetkellinenkin jakaminen siten, että kaksi aiempaa haluttua ominaisuutta pysyvät voimassa on Brewerin mukaan mahdotonta.  Käytäntö on osoittanut, että vain kaksi näistä kolmesta esitellystä omainaisuudesta voidaan pitää samanaikaisesti voimassa <cite>Bre02</cite>.
				</pre>
			</section>
			
			
			<section>
				<h1>BASE</h1>
				
				<pre>Tietokantojen ACID-mallin rinnalle on hajautettujen web-palveluiden yleistymisen myötä noussut BASE-malli (<strong>BA</strong>sically available, <strong>S</strong>oft state, <strong>E</strong>ventually consistent).  Mallissa otetaan huomioon web-palveluiden erityispiirteet, kuten tilattomuus, joka mahdollistaa tiedon tallentamisen kevyimmin ehdoin <cite>Pri08</cite>.
					
					Ehdottoman saatavuuden (kaikki saatavilla, tai ei mitään saatavilla) sijaan tieto pyritään pitämään saatavilla niin hyvin kuin mahdollista.  Palvelu tulee olla rakennettu siten, että jos esimerkiksi 20% tietosisällöstä on hetkellisesti saavuttamattomissa, niin se vaikuttaa vain osaan käyttäjistä.  Parhaimmassa tapauksessa suurin osa käyttäjistä ei edes huomaa katkosta. Tämä on mahdollista saavuttaa jakamalla tieto toiminnallisiin kokonaisuuksinsa <cite>Pri08</cite>.
				
					Web-palveluissa, jotka eivät esimerkiksi käsittele rahaa, voidaan vahvasta transaktionaalisuudesta joustaa.  Katkoksen tapahtuminen kriittisellä hetkellä on yleisesti harvinaisia ja luopumalla transaktioista voidaan saavuttaa parempi suorituskyky ja joustavampi arkkitehtuuri.  Lisäksi virhetilanteita voidaan välttää esimerkiksi suunnittelemalla operaatiot <em>idempotenttisiksi</em> <!-- TODO: mikä on idempotent suomeksi -->, eli siten, että operaatio voidaan ajaa useasti peräkkäin ja sen vaiktus tietosisältöön on sama <cite>Pri08</cite>.
			
					Hetkelliset poikkeamat käyttäjille näkyvässä tietosisällössä voivat hyvinkin olla käytännössä siedettäviä.  Esimerkiksi kun käyttäjä jakaa jonkin tiedon kaveriverkostolleen, voidaan tiedon näyttämistä muille viivästyttää useitakin sekunteja.  Riittää, että muutoksen tehneelle käyttäjälle annetaan illuusio välittömästä päivittämisestä <cite>Pri08</cite>.
					
				</pre>
			</section>

			
			<section>
	        	<h1>Cloud tasot</h1>

	        	<pre>

					saas
					paas
					iaas

					attribuutit
					* pay as you go
					* kato gradu
				</pre>

	    	</section>				
				

		</section>
		
		<section>
			<h1>Suuren kokoluokan arkkitehtuurit</h1>
			
			<pre>
				Muutamia suosituimpia sosiaalisen median palveluita Alexa-yhtiön "Top 500 Global Sites" listauksessa olivat lokakuussa 2010: Facebook.com (2), Youtube.com (3), Linkedin.com (23) ja Flickr.com (36) <cite>Ale10</cite>.  Seuraavissa kappaleissa käydään läpi palveluiden muutamia tunnuslukuja ja yleiskuvaus arkkitehtuurista.  Luvut perustuvat palveluiden omiin ilmoituksiin, joita voitaneen pitää yleisesti luotettavina tai ainakin suuntaa-antavina.
			</pre>
			
			<section>
				<h1>Facebook.com</h1>
				
				<pre>
				Facebook.com on ylivoimaisesti suurin sosiaalisen median verkosto, jossa käyttäjät voivat jakaa kuviaan, videoitaan ja vaihtaa viestejä.
				
				<ul>
					<li>Yli 500 miljoonaa aktiivista käyttäjää</li>
					<li>50% prosenttia käyttäjistä kirjautuu palveluun päivittäin</li>
					<li>Käyttäjällä on keskimäärin 130 <em>ystävää</em>, eli henkilöä, jonka tuntee palvelussa.</li>
					<li>Facebook palvelee yli 150 miljoonaa samanaikaista mobiilikäyttäjää.</li>
				</ul>

				Lisäksi Facebook tarjoaa myös kehittäjille API-rajapintoja, joiden kautta oma palvelu integroituu käyttäjän kannalta osaksi Facebookkia.  Aktiivisia Facebook-sovelluksia on tällä hetkellä 550,000 kappaletta. 70% palvelun käyttäjistä käyttää jotakin sovellusta vähintään kerran kuukaudessa <cite>Fac10</cite>.
				</pre>
				
				<section>
					<h1>Tiedon tallentamisen haasteet</h1>
					
					<pre>
						Vuonna 2009 Facebook suoritti yli 200 miljardia kuukausittaista sivunäyttöä ja käyttäjistä 70% tuli Yhdysvaltojen ulkopuolelta.  Palvelua ajettiin n. 30,000 palvelimella, joista suurin osa oli applikaatiopalvelimia, jotka ajoivat PHP- ja C++-koodia.  Palvelimet sijaitsevat kahdessa palvelinkeskuksessa Yhdysvaltojen itä- ja länsirannikoilla <cite>Rot09</cite>.
						
						Facebook tallentaa päivittäin valtavat määrät tietoa, josta muodostetaan mm. palveluun sisältöä käyttäjille, raportteja ja statistiikkaa mainostajille. Facebookin työntekijöiden Thusoo et al. kirjoittamassa artikkelissa <em>"Data Warehousing and Analytics Infrastructure at Facebook"</em> <cite>TSA10</cite> kerrotaan päivittäin talletettavan datamäärän ylittävän kirjoitushetkellä 60 teratavua päivässä.  Kaikki tieto on pidettävä tallessa ja kokonaistietomäärä ylitti 15 petatavua.  Tallennettavan tiedon määrä myös kasvaa jatkuvasti voimakkaasti: 6kk ajanjaksolla päivittäin talletettavan tiedon määrä kolminkertaistui <cite>TSA10</cite>.
						
						Tälläisen tietomäärän tallentaminen ja hallinta siten, että tietoa voidaan hyödyntää eri käyttötarkoituksiin samalla säilyttäen kustannustehokkuus ja skaalautuvuus asettaa uusia haasteita, joita harvoissa palveluissa on jouduttu ratkaisemaan.  Tärkein yksittäinen periaate on skaalautua horisontaalisesti käyttäen kuluttajatason laitteita <cite>TSA10</cite>. Suuri osa palvelun kehittämisen ja skaalaamisen yhteydessä kirjoitetuista komponenteista on julkistettu vapaana lähdekoodina <cite>Fac10b, TSA10</cite>.
					</pre>
				</section>	
				
				<section>
					<h1>Käytettyjä tekniikoita</h1>
					
					<pre>
						Tietoa tallennetaan viivästetysti siten, että sen tallentaminen ei haittaa arkkitehtuurin muuta toimintaa.  WWW-applikaatiopalvelimien tuottama logitieto tallennetaan eräajoina väliaikaiseen tietovarastoon, josta se talletetaan edelleen kahteen päätietovarastoon: tuotantoon ja <em>adhoc</em>-tietovarastoihin.  Tuotantotietovarastosta tieto siirretään edelleen MySQL-klusteriin, kun taas adhoc-tietovarastosta kuka tahansa kehittäjä voi ajaa tarvittaessa kyselyitä häiritsemättä tuotantoa <cite>TSA10</cite>.
						
						Johtuen suuresta välimatkasta palvelinkeskusten välillä, MySQL-tietokanta on jaettu kahtia siten, että tietokannan päivitysoperaatiot tehdään länsirannikon palvelinkeskuksessa ja replikoidaan itärannikolle.  Replikointi valmistuu 20 sekunnin aikaikkunan aikana.  Tuon 20 sekunnin aikana tietosisältöä muuttaneen käyttäjän kaikki pyynnöt ohjataan länsirannikolle, jotta tietosisältö on käyttäjän näkökulmasta ehjä <cite>Rot09, Sob08</cite>
						
						
						Tärkein näkymä käyttäjälle muodostetaan käyttäjän sosiaalisen verkoston viimeaikaisista tapahtumista.  Tällöin suuri osa palvelun tietosisällöstä saa jatkuvasti paljon lukuoperaatiota.  Applikaatiopalvelimien ja MySQL-tietokannan välissä on suurikokoinen <em>memcached</em>-välimuisti, jossa käytännössä koko tietosisältö on talletettuna RAM-muistiin.  Kun tietosisältöä päivitetään, päivitetään samalla myös välimuistin sisältö, jolloin tietokanta välttyy kyselyiltä.  Yhteensä välimuistikerros palvelee noin. 120 miljoonaa pyyntöä sekunnissa <cite>Rot09</cite>.
											 
						Staattisten tiedostojen palveleminen käyttäjille, kuten kuvatiedostojen näyttämien aiheuttaa helposti useita IO-kutsuja.  Kuvatiedostoja jaettiin hetkittäin vuonna 2009 jopa 550,000 kappaletta sekunnissa <cite>Vaj09</cite>.  Kuvien jakaminen IO-kutsujen minimointiin on kehitty palvelu nimeltä <em>haystack</em>.  Haystack kirjoittaa kuvatiedostot albumeittain yhteen logitiedostoon.  Logitiedostosta voidaan hakea kuvadataa hakemiston avulla, joka tallettaa tiedston paikan logissa ym. metatietoa.  Ratkaisulla pienennettiin IO-kutsujen määrä n. 10:stä 2-4:n / palveltu kuvatiedosto <cite>Vaj09, Rot09</cite>.
		
		<!-- 				
			TODO:			Viestijonot: scribe, thrift
			-->			
						
						
						
						
					</pre>
				</section>
				
			</section>
			
			<section>
				<h1>Youtube</h1>
			
				<cite>Cuo07</cite>
			
			</section>
			
			<section>
				<h1>LinkedIn</h1>
			</section>
			
			<section>
				<h1>Flickr</h1>
					
				<pre>
				Flickr.com on vuonna 200TODO perustettu kuvien jakamiseen keskittynyt palvelu.
				</pre>
			</section>
			
	  	</section>
              
              
		<section>
	    	<h1>Mittee myö nyt</h1>
 
	    	<pre>
				<cite>XXJ09</cite> viittaavat haystack-noteen ja tarjoavat omaa ratkaisuaan.
								
				commodity hardware
				
				share nothing
				
				federated
				
				hadoop
				
				eventual consitency
				
				* onko mendeleyssä ratkaisuja

				Farmville
			
			</pre>
			
		</section>
		
	
      	<section>
			<h1>Yhteenveto</h1>
			
			<pre>
				Eventual consistency.
				
				<h2>Databases and Web 2.0 Panel at VLDB 2007</h2>
				
				heterogeeniset tietokannat nykyisten homogeenisten sijaan
			</pre>
		</section>
		
		<section class="noNumbering">
			<h1>Kiitokset</h1>
			
			<pre>
				Tätä artikkelia ei olisi voitu kirjoittaa ilman Pekon lämmittämää Harjutorin Saunaa, Kurvin Grillin Porilaista ja Oljenkorren Sierra Nevada Celebration Alea. 
			</pre>
		</section>
		
		
    </article>
    
    <article class="glossary">
		<h1>Lyhenteet</h1>
		
		<dl>
			<dt>ACID</dt>
			<dd>Atomicity, Consistency, Isolation, Durability</dd>
			
			<dt>API</dt>
			<dd>Application Programming Interface
			<dd>Ohjelmointirajapinta</dd>
			
			<dt>BASE</dt>
			<dd>BAsically Available, Soft state, Eventually consistent</dd>
			<dd>Vaihtoehto ACID-mallille</dd>
			
			<dt>UGC</dt>
			<dd>User-generated Content</dd>
			<dd>Käyttäjien luoma sisältö web-palvelussa</dd>
		</dl>
	</article>
    
    <article class="references">
		<h1>Lähteet</h1>

		<dl>
			
			<dt data-lattex="GJW07">GJW07</dt>
			<dd>
				@inproceedings{1241011,
				 author = {Golbeck, Jennifer and Wasser, Michael M.},
				 title = {SocialBrowsing: integrating social networks and web browsing},
				 booktitle = {CHI '07: CHI '07 extended abstracts on Human factors in computing systems},
				 year = {2007},
				 isbn = {978-1-59593-642-4},
				 pages = {2381--2386},
				 location = {San Jose, CA, USA},
				 doi = {http://doi.acm.org/10.1145/1240866.1241011},
				 publisher = {ACM},
				 address = {New York, NY, USA},
				 }
			</dd>

			<dt data-lattex="Gol07">Gol07</dt>
			<dd>
				@ARTICLE{Golbeck_thedynamics,
				    author = {Jennifer Golbeck},
				    title = {The dynamics of web-based social networks: Membership, relationships, and change},
				    journal = {First Monday},
				    year = {},
				    volume = {12},
				    pages = {2007}
				}{New York, NY, USA},
				 }
			</dd>
			
			<dt data-lattex="Fac10">Fac10</dt>
			<dd>
				Facebook Statistics, http://www.facebook.com/press/info.php?statistics.  Haettu 19.10.2010.
			</dd>

			<dt data-lattex="Cuo07">Cuo07</dt>
			<dd>
				Do Cuong. YouTube Scalability, Google Seattle Conference on Scalability Saturday, June 23, 2007 - http://www.youtube.com/watch?v=ZW5_eEKEC28
			</dd>

			<dt data-lattex="Ale10">Ale10</dt>
			<dd>
			Alexa.com Top 500 Global Sites, http://www.alexa.com/topsites, haettu 19.10.2010
			</dd>
			
			<dt data-lattex="Rot09">Rot09</dt>
			<dd>
				Rothschild, Jeff. High Performance at Massive Scale - Lessons learned at Facebook, UC San Diego CNS 2009 Lecture Series Archives, October 8, 2009, http://cns.ucsd.edu/lecturearchive09.shtml#Roth
			</dd>
			<!--
			http://idleprocess.wordpress.com/2009/11/24/presentation-summary-high-performance-at-massive-scale-lessons-learned-at-facebook/
			-->
			
			<dt data-lattex="YLM09">YLM09</dt>
			<dd>
				@inproceedings{1557123,
				 author = {Yin, Zhijun and Li, Rui and Mei, Qiaozhu and Han, Jiawei},
				 title = {Exploring social tagging graph for web object classification},
				 booktitle = {KDD '09: Proceedings of the 15th ACM SIGKDD international conference on Knowledge discovery and data mining},
				 year = {2009},
				 isbn = {978-1-60558-495-9},
				 pages = {957--966},
				 location = {Paris, France},
				 doi = {http://doi.acm.org/10.1145/1557019.1557123},
				 publisher = {ACM},
				 address = {New York, NY, USA},
				 }
			</dd>
			
			<dt data-lattex="Sob08">Sob08</dt>
			<dd>
				Sobel, Jason.  Scaling Out. August 20, 2008. http://www.facebook.com/note.php?note_id=23844338919&id=9445547199&index=0 
			</dd>

			<dt data-lattex="Fac10b">Fac10b</dt>
			<dd>
				Facebook Developers - Open Source. http://developers.facebook.com/opensource/. Haettu 19.10.2010
			</dd>
			
			<dt data-lattex="Vaj09">Vaj09</dt>
			<dd>
			Vajgel, Peter.  Needle in a haystack: efficient storage of billions of photos.  http://www.facebook.com/note.php?note_id=76191543919.  Haettu 19.10.2010.
			</dd>
			
			<dt data-lattex="XXJ09">XXJ09</dt>
			<dd>
				@inproceedings{1654086,
				 author = {Xing, Jing and Xiong, Jin and Sun, Ninghui and Ma, Jie},
				 title = {Adaptive and scalable metadata management to support a trillion files},
				 booktitle = {SC '09: Proceedings of the Conference on High Performance Computing Networking, Storage and Analysis},
				 year = {2009},
				 isbn = {978-1-60558-744-8},
				 pages = {1--11},
				 location = {Portland, Oregon},
				 doi = {http://doi.acm.org/10.1145/1654059.1654086},
				 publisher = {ACM},
				 address = {New York, NY, USA},
				 }
			</dd>
			
			
			<dt data-lattex="TSA10">TSA10</dt>
			<dd>Thusoo A, Shao Z, Anthony S, et al. Data warehousing and analytics infrastructure at facebook. Proceedings of the 2010 international conference on Management of data - SIGMOD '10. 2010:1013. Available at: http://portal.acm.org/citation.cfm?doid=1807167.1807278.
			</dd>
			
			<dt data-lattex="PES10">PES10</dt>
			<dd>Pujol JM, Erramilli V, Siganos G, et al. The Little Engine ( s ) That Could : Scaling Online Social Networks. 2010:375-386.
			</dd>
			
			<dt data-lattex="Bre02">Bre02</dt>
			<dd>Eric A. Brewer. Towards robust distributed systems. (Invited Talk) Principles of Distributed Computing, Portland, Oregon, July 2000.</dd>
			
			<dt data-lattex="GiL02">GiL02</dt>
			<dd>Gilbert S, Lynch N. Brewer's conjecture and the feasibility of consistent, available, partition-tolerant web services. ACM SIGACT News. 2002;33(2):51. Available at: http://portal.acm.org/citation.cfm?doid=564585.564601.</dd>
			
			<dt data-lattex="Pri08">Pri08</dt>
			<dd>Pritchett D. BASE: An Acid Alternative. Queue. 2008;(June 2008). Available at: http://portal.acm.org/citation.cfm?id=1394128.</dd>
		</dl>
			

    </article>
  


    <footer>
      <span data-lattex="pagenumber"></span>  <span>&copy; pottisheads</span>
    </footer>
    

  </body>

</html>
